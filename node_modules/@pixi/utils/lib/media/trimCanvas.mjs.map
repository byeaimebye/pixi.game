{"version":3,"file":"trimCanvas.mjs","sources":["../../src/media/trimCanvas.ts"],"sourcesContent":["import type { ICanvas } from '@pixi/settings';\n\nfunction checkRow(data: Uint8ClampedArray, width: number, y: number)\n{\n    for (let x = 0, index = 4 * y * width; x < width; ++x, index += 4)\n    {\n        if (data[index + 3] !== 0) return false;\n    }\n\n    return true;\n}\n\nfunction checkColumn(data: Uint8ClampedArray, width: number, x: number, top: number, bottom: number)\n{\n    const stride = 4 * width;\n\n    for (let y = top, index = (top * stride) + (4 * x); y <= bottom; ++y, index += stride)\n    {\n        if (data[index + 3] !== 0) return false;\n    }\n\n    return true;\n}\n\n/**\n * Trim transparent borders from a canvas\n * @memberof PIXI.utils\n * @function trimCanvas\n * @param {PIXI.ICanvas} canvas - the canvas to trim\n * @returns {object} Trim data\n */\nexport function trimCanvas(canvas: ICanvas): { width: number; height: number; data?: ImageData }\n{\n    // https://gist.github.com/timdown/021d9c8f2aabc7092df564996f5afbbf\n\n    let { width, height } = canvas;\n\n    const context = canvas.getContext('2d', {\n        willReadFrequently: true,\n    });\n    const imageData = context.getImageData(0, 0, width, height);\n    const data = imageData.data;\n\n    let top = 0;\n    let bottom = height - 1;\n    let left = 0;\n    let right = width - 1;\n\n    while (top < height && checkRow(data, width, top)) ++top;\n    if (top === height)\n    {\n        return { width: 0, height: 0, data: null };\n    }\n    while (checkRow(data, width, bottom)) --bottom;\n    while (checkColumn(data, width, left, top, bottom)) ++left;\n    while (checkColumn(data, width, right, top, bottom)) --right;\n\n    width = right - left + 1;\n    height = bottom - top + 1;\n\n    return {\n        width, height,\n        data: context.getImageData(left, top, width, height),\n    };\n}\n"],"names":[],"mappings":"AAEA,SAAkB,QAAA,CAAA,IAAA,EAAyB,OAAe,CAC1D,EAAA;AACI,EAAS,KAAA,IAAA,CAAA,GAAI,CAAG,EAAA,KAAA,GAAQ,CAAI,GAAA,CAAA,GAAI,KAAO,EAAA,CAAA,GAAI,KAAO,EAAA,EAAE,CAAG,EAAA,KAAA,IAAS,CAChE,EAAA;AACI,IAAI,IAAA,IAAA,CAAK,QAAQ,CAAO,CAAA,KAAA,CAAA;AAAG,MAAO,OAAA,KAAA,CAAA;AAAA,GACtC;AAEA,EAAO,OAAA,IAAA,CAAA;AACX,CAAA;AAEA,SAAA,WAAA,CAAqB,IAAyB,EAAA,KAAA,EAAe,CAAW,EAAA,GAAA,EAAa,MACrF,EAAA;AACI,EAAA,MAAM,SAAS,CAAI,GAAA,KAAA,CAAA;AAEnB,EAAA,KAAA,IAAS,CAAI,GAAA,GAAA,EAAK,KAAS,GAAA,GAAA,GAAM,MAAW,GAAA,CAAA,GAAI,CAAI,EAAA,CAAA,IAAK,MAAQ,EAAA,EAAE,CAAG,EAAA,KAAA,IAAS,MAC/E,EAAA;AACI,IAAI,IAAA,IAAA,CAAK,QAAQ,CAAO,CAAA,KAAA,CAAA;AAAG,MAAO,OAAA,KAAA,CAAA;AAAA,GACtC;AAEA,EAAO,OAAA,IAAA,CAAA;AACX,CAAA;AASO,SAAA,UAAA,CAAoB,MAC3B,EAAA;AAGI,EAAI,IAAA,EAAE,OAAO,MAAW,EAAA,GAAA,MAAA,CAAA;AAExB,EAAM,MAAA,OAAA,GAAU,MAAO,CAAA,UAAA,CAAW,IAAM,EAAA;AAAA,IACpC,kBAAoB,EAAA,IAAA;AAAA,GACvB,CAAA,CAAA;AACD,EAAA,MAAM,YAAY,OAAQ,CAAA,YAAA,CAAa,CAAG,EAAA,CAAA,EAAG,OAAO,MAAM,CAAA,CAAA;AAC1D,EAAA,MAAM,OAAO,SAAU,CAAA,IAAA,CAAA;AAEvB,EAAA,IAAI,GAAM,GAAA,CAAA,CAAA;AACV,EAAA,IAAI,SAAS,MAAS,GAAA,CAAA,CAAA;AACtB,EAAA,IAAI,IAAO,GAAA,CAAA,CAAA;AACX,EAAA,IAAI,QAAQ,KAAQ,GAAA,CAAA,CAAA;AAEpB,EAAA,OAAO,GAAM,GAAA,MAAA,IAAU,QAAS,CAAA,IAAA,EAAM,OAAO,GAAG,CAAA;AAAG,IAAE,EAAA,GAAA,CAAA;AACrD,EAAA,IAAI,QAAQ,MACZ,EAAA;AACI,IAAA,OAAO,EAAE,KAAO,EAAA,CAAA,EAAG,MAAQ,EAAA,CAAA,EAAG,MAAM,IAAK,EAAA,CAAA;AAAA,GAC7C;AACA,EAAO,OAAA,QAAA,CAAS,IAAM,EAAA,KAAA,EAAO,MAAM,CAAA;AAAG,IAAE,EAAA,MAAA,CAAA;AACxC,EAAA,OAAO,WAAY,CAAA,IAAA,EAAM,KAAO,EAAA,IAAA,EAAM,KAAK,MAAM,CAAA;AAAG,IAAE,EAAA,IAAA,CAAA;AACtD,EAAA,OAAO,WAAY,CAAA,IAAA,EAAM,KAAO,EAAA,KAAA,EAAO,KAAK,MAAM,CAAA;AAAG,IAAE,EAAA,KAAA,CAAA;AAEvD,EAAA,KAAA,GAAQ,QAAQ,IAAO,GAAA,CAAA,CAAA;AACvB,EAAA,MAAA,GAAS,SAAS,GAAM,GAAA,CAAA,CAAA;AAExB,EAAO,OAAA;AAAA,IACH,KAAA;AAAA,IAAO,MAAA;AAAA,IACP,MAAM,OAAQ,CAAA,YAAA,CAAa,IAAM,EAAA,GAAA,EAAK,OAAO,MAAM,CAAA;AAAA,GACvD,CAAA;AACJ;;;;"}